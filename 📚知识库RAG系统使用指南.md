# 📚 GuardNova 知识库 RAG 系统使用指南

## 🎉 系统简介

GuardNova 现已集成完整的 **RAG (Retrieval Augmented Generation)** 知识库系统！

**核心功能：**
1. ✅ SQLite 数据库持久化存储
2. ✅ 智能搜索和匹配
3. ✅ 网页内容自动抓取
4. ✅ AI 智能问答先查知识库，后调用 OpenAI
5. ✅ 知识来源标注

---

## 📖 使用流程

### 1️⃣ 访问知识库

**方式一：侧边栏**
```
点击 "📚 知识库" 按钮
```

**方式二：快捷键**
- 侧边栏上方有两个按钮：
  - `➕ 新对话`
  - `📚 知识库` ← 点击此按钮

---

### 2️⃣ 添加知识

#### 📝 添加文本知识

1. 选择知识类型：`📝 文本`
2. 填写标题：例如 "公司安全规定"
3. 输入内容：完整的文本内容
4. 添加标签：例如 "安全,规定,公司"
5. 点击 `💾 保存到数据库`

**示例：**
```
标题：RMC Digital 安全政策
内容：
1. 所有员工必须使用双因素认证
2. 密码长度至少 12 位
3. 每 90 天更换一次密码
...

标签：安全,政策,员工
```

#### 📄 添加文件知识

1. 选择知识类型：`📄 文件`
2. 填写标题：例如 "员工手册 2024"
3. **上传文件**：点击上传按钮，选择文件
   - 支持格式：PDF, Word, TXT, MD, CSV, Excel
4. 文件描述（可选）：简要说明文件内容
5. 添加标签
6. 点击 `💾 保存到数据库`

**注意：**
- 文件会被保存到 `data/uploaded_files/` 目录
- 系统会尝试提取文本内容（目前支持 TXT 文件）
- 其他格式文件暂时存储描述信息

#### 🔗 添加网页链接 (RAG)

**这是最强大的功能！**

1. 选择知识类型：`🔗 网页链接 (RAG)`
2. 填写标题：例如 "最新网络安全趋势"
3. 输入 URL：`https://example.com/article`
4. 链接描述（可选）：简要说明
5. 添加标签
6. 点击 `💾 保存到数据库`

**系统会自动：**
- 🔍 抓取网页内容
- 📝 提取主要文本
- 💾 存储到数据库
- ⏰ 支持定时刷新（点击 "🔄 刷新" 按钮）

**示例：**
```
标题：2024 年网络安全报告
URL：https://cybersecurity.com/2024-report
描述：行业权威网络安全年度报告
标签：安全,报告,2024
```

---

### 3️⃣ 查看和管理知识

#### 查看所有知识

知识库界面下方会显示所有已保存的知识：

```
📖 已有知识
共 15 条知识

🔍 搜索知识: [输入关键词]

📝 公司安全规定
📄 员工手册 2024
🔗 2024 年网络安全报告
...
```

#### 搜索知识

输入关键词，系统会：
- 在标题中搜索
- 在内容中搜索
- 在标签中搜索

**示例：**
```
搜索："安全"
找到 5 条相关知识
```

#### 刷新网页内容

对于 `🔗 网页链接` 类型的知识：

1. 展开知识条目
2. 点击右侧 `🔄 刷新` 按钮
3. 系统重新抓取最新内容

**使用场景：**
- 定期更新的新闻/博客
- 动态变化的文档
- 实时数据页面

#### 删除知识

1. 展开知识条目
2. 点击右侧 `🗑️ 删除` 按钮
3. 确认删除

---

### 4️⃣ AI 智能问答 (RAG 集成)

**这是核心功能！**

#### 工作流程：

```
用户提问
    ↓
1. 搜索知识库 (3 条最相关)
    ↓
2a. 找到相关知识 → 使用 RAG 模式
    - AI 基于知识库内容回答
    - 结合通用知识补充
    - 标注来源
    ↓
2b. 没找到 → 使用通用模式
    - 直接调用 OpenAI
    ↓
3. 返回答案
```

#### 示例对话：

**场景 1：知识库有答案**

```
用户：公司的密码政策是什么？

AI：根据知识库中的"RMC Digital 安全政策"，公司的密码政策如下：

1. 所有员工必须使用双因素认证
2. 密码长度至少 12 位
3. 每 90 天更换一次密码
4. 不得使用常见密码或个人信息

---
📚 参考知识:
- RMC Digital 安全政策 (text)
```

**场景 2：知识库没有答案**

```
用户：什么是量子计算？

AI：量子计算是一种利用量子力学原理进行信息处理的计算方式...

（没有知识来源标注，说明使用了通用知识）
```

---

## 🔧 高级技巧

### 1. 优化标签

**好的标签：**
```
公司,安全,政策,2024
```

**不好的标签：**
```
这是一个关于安全的文档
```

### 2. 结构化内容

**推荐格式：**
```
标题：清晰明确
内容：
1. 第一点
2. 第二点
3. 第三点

标签：关键词1,关键词2
```

### 3. 定期更新网页知识

建议频率：
- 新闻类：每天
- 文档类：每周
- 政策类：每月

### 4. 知识库命名规范

**推荐：**
```
"2024 Q1 销售报告"
"员工入职流程 v2.0"
"网络安全最佳实践"
```

**不推荐：**
```
"文档1"
"重要信息"
"新文件"
```

---

## 🗃️ 数据存储

### 数据库位置

```
/Users/sven/Cursor_Project/RMC_Digital/data/knowledge_base.db
```

### 文件存储

```
/Users/sven/Cursor_Project/RMC_Digital/data/uploaded_files/
```

### 备份建议

**定期备份：**
```bash
cd /Users/sven/Cursor_Project/RMC_Digital
cp -r data/ data_backup_$(date +%Y%m%d)/
```

---

## 🚀 部署到 Streamlit Cloud

### 注意事项

1. **数据持久化问题**
   - Streamlit Cloud 重启会清空数据
   - 建议使用外部数据库（如 Supabase, MongoDB）

2. **文件上传限制**
   - 单个文件最大 200MB
   - 总存储空间有限

3. **网页抓取限制**
   - 可能受防火墙影响
   - 某些网站禁止爬取

### 解决方案

**方案 1：使用云数据库**
```python
# 修改 modules/knowledge_base.py
# 将 SQLite 替换为 PostgreSQL (Supabase)
```

**方案 2：定期导出**
```python
# 定期导出知识库到 JSON
kb.export_to_json("backup.json")
```

---

## ❓ 常见问题

### Q1: 如何返回智能对话？

**答：** 点击知识库管理页面右上角的 `← 返回对话` 按钮。

### Q2: 文件上传后没有内容？

**答：** 目前只支持 TXT 文件的内容提取。其他格式请填写"文件描述"。

### Q3: 网页抓取失败怎么办？

**答：** 可能原因：
- 网站禁止爬虫
- 需要登录
- 网络问题

解决：手动复制内容，使用"文本"类型添加。

### Q4: AI 没有使用知识库？

**答：** 检查：
1. 知识库中是否有相关内容
2. 关键词是否匹配
3. 尝试更具体的问题

### Q5: 如何删除所有知识？

**答：** 
```bash
rm data/knowledge_base.db
# 重启应用会自动创建新数据库
```

---

## 📊 使用示例

### 示例 1：公司知识库

```
知识类型：📝 文本
标题：RMC Digital 公司介绍
内容：
RMC Digital 是一家专注于数字化转型的科技公司...

标签：公司,介绍,关于我们
```

### 示例 2：技术文档

```
知识类型：📄 文件
标题：API 接口文档 v3.0
文件：api_docs_v3.pdf
描述：最新的 RESTful API 接口文档

标签：API,文档,技术
```

### 示例 3：行业资讯

```
知识类型：🔗 网页链接 (RAG)
标题：2024 AI 发展趋势
URL：https://ai-trends.com/2024
描述：权威机构发布的 AI 年度报告

标签：AI,趋势,2024
```

---

## 🎯 最佳实践

1. **建立分类体系**
   - 按部门分类
   - 按主题分类
   - 按重要性分类

2. **定期维护**
   - 删除过期知识
   - 更新重要内容
   - 补充新知识

3. **优化搜索**
   - 使用清晰的标题
   - 添加详细标签
   - 结构化内容

4. **团队协作**
   - 制定命名规范
   - 分工负责不同领域
   - 定期review

---

## 🔮 未来计划

### 即将推出：

1. **向量搜索** (OpenAI Embeddings)
   - 更智能的语义匹配
   - 相似度排序

2. **多格式支持**
   - PDF 内容提取
   - Word 文档解析
   - Excel 数据导入

3. **定时任务**
   - 自动刷新网页内容
   - 定期备份数据库

4. **权限管理**
   - 知识可见性控制
   - 编辑权限设置

---

## 📞 技术支持

如有问题，请查看：
- 项目 README.md
- GitHub Issues
- 或联系开发团队

---

**祝您使用愉快！🎉**

